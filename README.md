# اسکنر IP برای V2Ray / Xray Core

این پروژه یک اسکنر ساده‌ی IP است که لیستی از IPها یا رنج‌های IP را می‌گیرد و به‌صورت موازی روی آن‌ها تست سرعت دانلود/آپلود انجام می‌دهد. هدف اصلی استفاده از این اسکنر برای ساخت کانفیگ‌های قابل استفاده با **Xray Core** (هسته‌ی V2Ray) است.

> توجه: این ابزار برای استفاده‌ی شخصی/آزمایشی طراحی شده است. مسئولیت استفاده از آن بر عهده‌ی کاربر است.

---

## قابلیت‌ها

* خواندن IPها و رنج‌ها از فایل جداگانه
* پشتیبانی از تست دانلود یا آپلود (یا هر دو)
* اجرای موازی با تعداد Thread دلخواه
* تعیین سرعت حداقل بر حسب کیلوبایت
* فایل کانفیگ Xray به‌صورت متغیر
* قابلیت انتخاب تصادفی IPها (Random Test)
* قابلیت Auto Skip برای پرش سریع از رنج‌هایی که شرایط لازم را ندارند
* سه شرط OR برای عبور از رنج بعدی:
  1. ۱۰٪ از رنج اسکن شود
  2. ۵ IP موفق از رنج پیدا شود
  3. ۳ دقیقه از اسکن رنج گذشته باشد

---

## پیش‌نیازها

* Python 3.9+
* باینری `xray` در مسیر سیستم یا مشخص کردن مسیر آن
* نصب بودن `curl` برای تست دانلود/آپلود

---

## نحوه کار

ورودی‌ها به سه بخش تقسیم می‌شوند:

1. **فایل لیست IP / Range**  
2. **فایل کانفیگ Xray**  
3. **پارامترهای اجرایی** (تعداد ترد، سرعت دانلود، فعال/غیرفعال بودن Random و Auto Skip و ...)

برنامه IPها را از فایل می‌خواند، سپس برای هر IP یک تست سرعت (دانلود/آپلود) اجرا می‌کند و در صورت موفقیت، خروجی مناسب تولید می‌شود.

---

## فرمت فایل لیست IP / Range

در فایل ورودی می‌توانید هر خط را به یکی از صورت‌های زیر بنویسید:

```
192.168.1.10
10.0.0.0/24
172.16.0.1-172.16.0.100
```

* **تک IP** → مستقیم تست می‌شود
* **CIDR** → به لیست IP تبدیل می‌شود
* **Range** → از ابتدای رنج تا انتها بررسی می‌شود

---

## فایل کانفیگ Xray

فایل کانفیگ JSON به‌صورت کامل قابل تغییر است. برنامه از قالب زیر استفاده می‌کند و فقط آدرس سرور (IP) را برای هر تست جایگزین می‌کند.

مثال ساده:

```json
{
  "outbounds": [
    {
      "protocol": "vless",
      "settings": {
        "vnext": [
          {
            "address": "PLACEHOLDER_IP",
            "port": 443,
            "users": [
              {
                "id": "UUID-HERE",
                "encryption": "none"
              }
            ]
          }
        ]
      }
    }
  ]
}
```

در فایل کانفیگ باید جای IP با متن `PLACEHOLDER_IP` مشخص شود.

همچنین پیشنهاد می‌شود در کانفیگ، یک inbound از نوع `socks` روی `127.0.0.1:10808` داشته باشید تا اسکریپت بتواند با `curl` از طریق پراکسی تست بگیرد.

---

## پارامترهای قابل تنظیم

* `--threads` : تعداد Thread موازی
* `--download` : فعال کردن تست دانلود
* `--upload` : فعال کردن تست آپلود
* `--speed` : سرعت حداقل (KB/s) برای قبول موفقیت
* `--random` : تست تصادفی IPها
* `--autoskip` : فعال‌سازی Auto Skip
* `--ip-file` : مسیر فایل IPها
* `--config` : مسیر فایل کانفیگ Xray
* `--download-url` : آدرس فایل تست دانلود
* `--upload-url` : آدرس تست آپلود
* `--upload-size-kb` : حجم داده‌ی تست آپلود
* `--xray-bin` : مسیر باینری Xray
* `--proxy` : پراکسی محلی (پیش‌فرض socks5 روی 10808)
* `--out` : خروجی نتایج موفق

مثال اجرا:

```
python3 scanner.py \\
  --ip-file ips.txt \\
  --config xray.json \\
  --threads 20 \\
  --download \\
  --speed 500 \\
  --random \\
  --autoskip
```

---

## منطق Auto Skip (سه شرط OR)

برای هر رنج IP، سه شرط زیر بررسی می‌شود. اگر هر کدام برقرار شود، برنامه به رنج بعدی می‌رود:

1. **۱۰٪ از IPهای رنج بررسی شوند**
2. **۵ IP موفق پیدا شوند**
3. **۳ دقیقه از زمان شروع اسکن آن رنج گذشته باشد**

---

## خروجی

* IPهایی که تست موفق داشته‌اند ذخیره می‌شوند
* رنج‌هایی که شرایط Auto Skip را داشته باشند زودتر رها می‌شوند
* در پایان، لیست نهایی IPهای موفق در خروجی چاپ و ذخیره خواهد شد

---

فرمت خروجی:

```
<ip>,<download_kbps>,<upload_kbps>
```

---

## نکته درباره تست دانلود/آپلود

اگر از endpointهای عمومی اینترنتی استفاده کنید ممکن است با محدودیت سرعت یا نرخ مواجه شوید. برای جلوگیری از این مشکل:

1. می‌توانید یک فایل تست را روی سرور خودتان میزبانی کنید و از `--download-url` استفاده کنید.
2. برای آپلود، بهتر است endpointی داشته باشید که حجم داده را قبول کند (مثلا یک سرور ساده که بدنه‌ی درخواست را دریافت کند).
3. اگر سرور مقصد خودتان باشد، محدودیت کمتری خواهید داشت و نتایج دقیق‌تر خواهند بود.

---

## نکته مهم

این پروژه در مرحله ابتدایی است و برای توسعه بیشتر آماده می‌باشد.

اگر نیاز دارید ویژگی خاصی اضافه شود، می‌توانید در همین مخزن ادامه دهید.
